<!DOCTYPE HTML>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

  <title>SAGE Robo</title>
  <meta name="description" content="Website of SAGE Robotics.">
  <meta name="author" content="Zizhe Zhang">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" href="media/favicon/sagerobo.ico" type="image/x-icon">
  <link rel="stylesheet" type="text/css" href="stylesheet.css">

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="js/authors.js"></script>
  <script src="js/publications.js"></script>

</head>

<body>
  <table
    style="width:100%;max-width:1000px;border:0px;border-spacing:0px;border-collapse:separate;margin-right:auto;margin-left:auto;">
    <tbody>
      <tr style="padding:0px">
        <td style="padding:0px">
          <table
            style="width:100%;border:0px;border-spacing:0px;border-collapse:separate;margin-right:auto;margin-left:auto;">
            <tbody>
              <tr style="padding:0px">
                <td style="padding:0%0%0%0%;width:5%;max-width:5%;"></td>
                <td style="padding:0%0%0%0%;width:22%;max-width:22%;">
                  <img style="width:100%;object-fit: cover; border-radius: 5%; display: block;" alt="profile photo"
                    src="media/pics/sagerobo.PNG" class="hoverZoomLink">
                </td>
                <td style="padding:0%;width:60%;vertical-align:middle">
                  <p class="name" style="text-align: center;">
                    SAGE Robotics
                  </p>
                  <p class="subname" style="text-align: center;">
                    <span class="sa-underline">SA</span>fe, <span class="sa-underline">AG</span>ile, and <span
                      class="sa-underline">GE</span>neralizable Robotics
                  </p>
                </td>
                <td style="padding:0%0%0%0%;width:5%;max-width:5%;"></td>
              </tr>
            </tbody>
          </table>
          <br>

          <table
            style="width:100%;border:0px;border-spacing:0px;border-collapse:separate;margin-right:auto;margin-left:auto;">
            <tbody>
              <tr>
                <td style="padding:16px;width:100%;vertical-align:middle">
                  <h2>News</h2>
                  <ul style="list-style-type: none; padding-left: 0;">
                    <li><strong style="margin-right: 10px;">Nov 2025:</strong>The idea for SAGE Roboticsâ€”Safe, Agile,
                      and Generalizable Roboticsâ€”was conceived in November 2025 during a trip to Puerto Rico ğŸ‡µğŸ‡·.
                    </li>
                  </ul>
                </td>
              </tr>
            </tbody>
          </table>

          <table
            style="width:100%;border:0px;border-spacing:0px;border-collapse:separate;margin-right:auto;margin-left:auto;">
            <tbody>
              <tr>
                <td style="padding:16px 16px 0px 16px;width:100%;vertical-align:middle">
                  <h2>
                    Publications 
                    <span style="font-size: clamp(16px, 3.3vw, 25px); font-weight: normal; margin-left: 5px;">
                      (
                      <span class="filter-btn" id="btn-selected" onclick="renderPubs('selected')">show selected</span> /
                      <span class="filter-btn" id="btn-date" onclick="renderPubs('date')">show all by date</span> /
                      <span class="filter-btn" id="btn-topic" onclick="renderPubs('topic')">show all by topic</span>
                      )
                    </span>
                    </h2>
                  <div id="topic-bar" style="display:none;"></div>
                </td>
              </tr>
              <tr>
                <td style="padding:0px 16px 16px 16px;width:100%;vertical-align:middle">
                  <p style="margin: 0px;">* and â€  denote equal contribution.</p>
                </td>
              </tr>
            </tbody>
          </table>

          <table
            style="padding:0px 16px 0px 16px;width:100%;height:auto;border:0px;border-spacing:0px;border-collapse:separate;margin-right:auto;margin-left:auto;">
            <tbody id="pub-list">
              </tbody>
          </table>

          <table
            style="width:100%;border:0px;border-spacing:0px;border-collapse:separate;margin-right:auto;margin-left:auto;">
            <tbody>
              <tr>
                <td style="padding:0px">
                  <br>
                  <p style="text-align:right;font-size:small;">
                  <div style="text-align: center;">Design and source code from <a href="https://jonbarron.info/">Jon
                      Barron's website</a>.</div>
                  </p>
                </td>
              </tr>
            </tbody>
          </table>
        </td>
      </tr>
  </table>

  <script>
    // --- è¾…åŠ©å‡½æ•° ---
    function formatAuthors(authors) {
      return authors.map(author => {
        let name = author.name;
        let info = authorsDb[name];
        let displayName = name;
        let mark = author.mark ? `${author.mark}` : "";

        if (info) {
          if (info.isMe) displayName = `<u><strong>${name}</strong></u>`;
          if (info.url) return `<a href="${info.url}">${displayName}</a>${mark}`;
          return `${displayName}${mark}`;
        }
        return `${name}${mark}`;
      }).join(", ");
    }

    function formatLinks(links) {
      if (!links) return "";
      return links.map(link => `<em><a href="${link.url}">${link.name}</a></em>`).join(" / ");
    }

    // ç”Ÿæˆå•ç¯‡è®ºæ–‡çš„ HTML è¡Œ
    function createPaperRow(pub) {
      // --- æ–°å¢é€»è¾‘ï¼šå¯»æ‰¾ç‚¹å‡»å›¾ç‰‡è·³è½¬çš„æœ€ä½³é“¾æ¥ ---
      let destUrl = null;
      if (pub.links && pub.links.length > 0) {
        // 1. ä¼˜å…ˆæ‰¾åå­—é‡ŒåŒ…å« "project", "website", "page" çš„é“¾æ¥
        let target = pub.links.find(l => /project|website|page/i.test(l.name));
        
        // 2. å¦‚æœæ²¡æ‰¾åˆ°ï¼Œå†æ‰¾ "paper", "pdf", "arxiv"
        if (!target) {
           target = pub.links.find(l => /paper|pdf|arxiv/i.test(l.name));
        }
        
        // 3. å®åœ¨æ²¡æœ‰ï¼Œå°±é»˜è®¤ç”¨åˆ—è¡¨é‡Œçš„ç¬¬ä¸€ä¸ªé“¾æ¥
        if (!target) {
           target = pub.links[0]; 
        }
        
        destUrl = target ? target.url : null;
      }

      // --- ç”Ÿæˆåª’ä½“å†…å®¹ (å›¾ç‰‡/è§†é¢‘) ---
      let mediaContent = "";
      let mediaStyle = pub.media.style || "";
      
      if (pub.media.type === "video") {
        mediaContent = `
            <video width="100%" height=auto muted autoplay loop playsinline style="border-radius: 4px;">
              <source src="${pub.media.src}" type="video/mp4">
              Your browser does not support the video tag.
            </video>`;
      } else {
        mediaContent = `
            <img src="${pub.media.src}" width="100%" alt="${pub.title}" style="${mediaStyle}; border-radius: 4px;">`;
      }

      // --- å…³é”®æ­¥éª¤ï¼šå¦‚æœæœ‰é“¾æ¥ï¼Œå°±ç”¨ <a> åŒ…è£¹åª’ä½“å†…å®¹ ---
      if (destUrl) {
          // target="_blank" è¡¨ç¤ºåœ¨æ–°çª—å£æ‰“å¼€
          // display: block é˜²æ­¢é“¾æ¥åº•éƒ¨æœ‰ç©ºéš™
          mediaContent = `<a href="${destUrl}" style="display:block; border:none;">${mediaContent}</a>`;
      }

      let mediaHtml = `
          <div class="two" style="opacity:1;">
            ${mediaContent}
          </div>`;

      let authorsHtml = formatAuthors(pub.authors);
      let linksHtml = formatLinks(pub.links);
      let venueAuxHtml = "";
      
      if (pub.venueAux) {
          // å¦‚æœæ˜¯æ•°ç»„ (æ¯”å¦‚å†™äº†3è¡Œ)
          if (Array.isArray(pub.venueAux)) {
              // éå†æ•°ç»„ï¼Œæ¯ä¸€è¡Œå‰é¢åŠ  <br>ï¼Œå¹¶ç”¨ <em> åŒ…è£¹
              venueAuxHtml = pub.venueAux.map(line => `<br><em>${line}</em>`).join("");
          } 
          // å¦‚æœæ˜¯æ™®é€šå­—ç¬¦ä¸² (å…¼å®¹ä»¥å‰çš„å†™æ³•)
          else {
              venueAuxHtml = `<br><em>${pub.venueAux}</em>`;
          }
      }

      return `
        <tr class="pub-row">
          <td style="padding:8px;width:25%;height:auto;vertical-align:middle">
            <div style="display:flex; align-items:center; justify-content:center;">
              <div class="one">
                ${mediaHtml}
              </div>
            </div>
          </td>
          <td style="padding:8px;width:75%;height:auto;vertical-align:middle">
            
            <strong class="papertitle" style="display:block; margin-bottom: 5px;">${pub.title}</strong>
            
            <div style="margin-bottom: 5px;">
                ${authorsHtml}
            </div>
            
            <div style="margin-bottom: 5px;">
                <em>${pub.venue}</em>
                ${venueAuxHtml}
            </div>
            
            <div style="margin-top: 5px;"> ${linksHtml}
            </div>

          </td>
        </tr>
      `;
    }

    // --- æ ¸å¿ƒæ¸²æŸ“é€»è¾‘ ---
    // æ–°å¢ï¼šspecificTopic å‚æ•°ï¼Œé»˜è®¤ä¸º null
    function renderPubs(mode, specificTopic = null) {
      const container = $("#pub-list");
      container.empty(); // æ¸…ç©ºåˆ—è¡¨

      // 1. æ›´æ–°ä¸»æŒ‰é’®çŠ¶æ€
      $(".filter-btn").removeClass("active");
      $("#btn-" + mode).addClass("active");

      let data = [...publicationsData]; // å¤åˆ¶æ•°æ®

      // 2. ç”Ÿæˆ Topics æ 
      // --- ä¿®æ”¹ç‚¹ Aï¼šæå–æ‰€æœ‰ Topic (æ”¯æŒæ•°ç»„ç»“æ„) ---
      // ä½¿ç”¨ flatMap æŠŠæ‰€æœ‰è®ºæ–‡çš„ topic æ•°ç»„é“ºå¹³ï¼Œç„¶åå»é‡
      const allTopics = [...new Set(
        data.flatMap(p => {
          if (Array.isArray(p.topic)) return p.topic; // å¦‚æœæ˜¯æ•°ç»„ï¼Œç›´æ¥è¿”å›
          if (p.topic) return [p.topic]; // å¦‚æœæ˜¯æ—§æ•°æ®çš„å­—ç¬¦ä¸²ï¼Œè½¬æˆæ•°ç»„
          return []; // å¦‚æœæ²¡å†™ topic
        })
      )].sort(); // åŠ ä¸Š .sort() è®© Topic æŒ‰å­—æ¯é¡ºåºæ’åˆ—ï¼Œçœ‹èµ·æ¥æ›´æ•´é½
      
      if (allTopics.length > 0) {
        const topicLinks = allTopics.map(t => {
          const isActive = (t === specificTopic) ? "active-topic" : "";
          return `<span class="topic-link ${isActive}" onclick="renderPubs('topic', '${t}')">${t}</span>`;
        }).join(" / ");
        
        $("#topic-bar").html("<strong>Topics:</strong> " + topicLinks).show();
      } else {
        $("#topic-bar").hide();
      }

      // 3. æ ¹æ®æ¨¡å¼æ¸²æŸ“
      if (mode === 'selected') {
        // --- æ¨¡å¼ A: Selected ---
        data = data.filter(p => p.selected).sort((a, b) => b.year - a.year);
        data.forEach(pub => container.append(createPaperRow(pub)));
      
      } else if (mode === 'date') {
        // --- æ¨¡å¼ B: By Date ---
        data.sort((a, b) => b.year - a.year);
        
        let lastYear = null;
        data.forEach(pub => {
          if (pub.year !== lastYear) {
            container.append(`<tr><td colspan="2" class="group-title">${pub.year}</td></tr>`);
            lastYear = pub.year;
          }
          container.append(createPaperRow(pub));
        });

      } else if (mode === 'topic') {
        // --- æ¨¡å¼ C: By Topic ---
        
        let topicsToRender = allTopics;
        
        // å¦‚æœä¼ å…¥äº†å…·ä½“çš„ specificTopicï¼Œå°±åªæ¸²æŸ“è¿™ä¸€ä¸ª
        if (specificTopic) {
            topicsToRender = [specificTopic];
        }

        // éå†éœ€è¦æ˜¾ç¤ºçš„ Topic
        topicsToRender.forEach(topic => {
          // --- ä¿®æ”¹ç‚¹ Bï¼šç­›é€‰é€»è¾‘ (æ”¯æŒæ•°ç»„åŒ…å«) ---
          const group = data.filter(p => {
             // å…¼å®¹æ€§å¤„ç†ï¼šå¦‚æœæ˜¯æ•°ç»„ç”¨ includesï¼Œå¦‚æœæ˜¯å­—ç¬¦ä¸²ç”¨ ===
             if (Array.isArray(p.topic)) {
                 return p.topic.includes(topic);
             }
             return p.topic === topic;
          });

          if (group.length > 0) {
             container.append(`<tr><td colspan="2" class="group-title">${topic}</td></tr>`);
            
            // ç»„å†…æŒ‰å¹´ä»½æ’åº
            group.sort((a, b) => b.year - a.year).forEach(pub => {
              container.append(createPaperRow(pub));
            });
          }
        });
      }
    }

    // é¡µé¢åŠ è½½å®Œæˆåï¼Œé»˜è®¤æ˜¾ç¤º selected
    $(document).ready(function () {
      renderPubs('selected');
    });
  </script>
</body>
</html>